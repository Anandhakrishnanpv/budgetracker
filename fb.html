<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Income & Budgeting Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intro.js/4.3.0/introjs.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intro.js/4.3.0/intro.min.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a0ca3;
            --secondary: #4cc9f0;
            --accent: #f72585;
            --info: #7209b7;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --background: #f0f2f5;
            --card-bg: #ffffff;
            --text-primary: #333333;
            --text-secondary: #6c757d;
            --border-radius: 12px;
            --box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            --transition: all 0.3s ease;
        }

        .dark-mode {
            --background: #121212;
            --card-bg: #1e1e1e;
            --text-primary: #f8f9fa;
            --text-secondary: #adb5bd;
            --light: #2d2d2d;
            --gray: #8a8a8a;
            --box-shadow: 0 5px 15px rgba(0,0,0,0.25);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background);
            color: var(--text-primary);
            transition: var(--transition);
            line-height: 1.6;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Background Elements */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .bg-circle {
            position: absolute;
            border-radius: 50%;
            opacity: 0.05;
            animation: float 25s infinite linear;
        }

        .bg-circle:nth-child(1) {
            width: 300px;
            height: 300px;
            background: var(--primary);
            top: 10%;
            left: 5%;
            animation-delay: 0s;
            animation-duration: 25s;
        }

        .bg-circle:nth-child(2) {
            width: 200px;
            height: 200px;
            background: var(--accent);
            top: 60%;
            left: 80%;
            animation-delay: -5s;
            animation-duration: 20s;
        }

        .bg-circle:nth-child(3) {
            width: 250px;
            height: 250px;
            background: var(--success);
            top: 30%;
            left: 70%;
            animation-delay: -10s;
            animation-duration: 30s;
        }

        .bg-circle:nth-child(4) {
            width: 180px;
            height: 180px;
            background: var(--warning);
            top: 70%;
            left: 10%;
            animation-delay: -15s;
            animation-duration: 22s;
        }

        @keyframes float {
            0% {
                transform: translate(0, 0) rotate(0deg);
            }
            25% {
                transform: translate(20px, 40px) rotate(90deg);
            }
            50% {
                transform: translate(0, 80px) rotate(180deg);
            }
            75% {
                transform: translate(-20px, 40px) rotate(270deg);
            }
            100% {
                transform: translate(0, 0) rotate(360deg);
            }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            flex-wrap: wrap;
            gap: 15px;
        }

        .dark-mode header {
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            font-size: 32px;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .theme-toggle {
            background: var(--card-bg);
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            font-weight: 500;
        }

        .theme-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .header-btn {
            padding: 10px 16px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .header-btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn {
            padding: 14px 24px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }

        .btn-success {
            background-color: var(--success);
        }

        .btn-success:hover {
            background-color: #27ae60;
        }

        .btn-warning {
            background-color: var(--warning);
        }

        .btn-warning:hover {
            background-color: #e67e22;
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .motivation-section {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 30px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
        }

        .motivation-quote {
            font-size: 22px;
            font-weight: 500;
            margin-bottom: 15px;
            text-align: center;
            font-style: italic;
        }

        .motivation-author {
            text-align: right;
            font-size: 14px;
            opacity: 0.8;
            margin-top: 10px;
        }

        .motivation-question {
            font-size: 18px;
            text-align: center;
            opacity: 0.9;
            margin-top: 20px;
            font-weight: 500;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            margin-bottom: 30px;
        }

        .dark-mode .card {
            box-shadow: var(--box-shadow);
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 25px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .dark-mode .card-title {
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .chart-toggle {
            display: flex;
            gap: 10px;
            background: var(--light);
            padding: 6px;
            border-radius: 8px;
        }

        .chart-toggle-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background: transparent;
            cursor: pointer;
            font-size: 14px;
            transition: var(--transition);
        }

        .chart-toggle-btn.active {
            background: var(--primary);
            color: white;
        }

        .income-input {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .income-input input {
            flex: 1;
            padding: 14px 18px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
            min-width: 200px;
        }

        .dark-mode .income-input input {
            background-color: var(--light);
            border-color: #444;
            color: var(--text-primary);
        }

        .income-input input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .budget-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .budget-table th, .budget-table td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .dark-mode .budget-table th, 
        .dark-mode .budget-table td {
            border-bottom: 1px solid #333;
        }

        .budget-table th {
            background-color: var(--light);
            font-weight: 600;
        }

        .dark-mode .budget-table th {
            background-color: #2d2d2d;
        }

        .budget-table input {
            width: 60px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }

        .dark-mode .budget-table input {
            background-color: var(--light);
            border-color: #444;
            color: var(--text-primary);
        }

        .expense-form {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            margin-bottom: 25px;
        }

        @media (max-width: 768px) {
            .expense-form {
                grid-template-columns: 1fr;
            }
            
            header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .header-controls {
                width: 100%;
                justify-content: space-between;
            }
            
            .income-input {
                flex-direction: column;
            }
            
            .card-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .chart-toggle {
                width: 100%;
                justify-content: center;
            }
            
            .time-period-selector {
                width: 100%;
                margin-top: 15px;
            }
        }

        .expense-form select, .expense-form input {
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
        }

        .dark-mode .expense-form select, 
        .dark-mode .expense-form input {
            background-color: var(--light);
            border-color: #444;
            color: var(--text-primary);
        }

        .expense-form select:focus, 
        .expense-form input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 30px;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .stat-card {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
            color: white;
            padding: 25px 20px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: var(--box-shadow);
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            margin: 15px 0;
        }

        .stat-label {
            font-size: 16px;
            opacity: 0.9;
        }

        .warning {
            color: var(--warning);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
            font-size: 14px;
        }

        .danger {
            color: var(--danger);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
            font-size: 14px;
        }

        .success {
            color: var(--success);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
            font-size: 14px;
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .report-table th, .report-table td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .dark-mode .report-table th, 
        .dark-mode .report-table td {
            border-bottom: 1px solid #333;
        }

        .report-table th {
            background-color: var(--light);
            font-weight: 600;
        }

        .dark-mode .report-table th {
            background-color: #2d2d2d;
        }

        .status-on-track {
            color: var(--success);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-over {
            color: var(--danger);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-under {
            color: var(--success);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .progress-bar {
            height: 12px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 12px 0;
        }

        .dark-mode .progress-bar {
            background-color: #333;
        }

        .progress-bar-fill {
            height: 100%;
            background-color: var(--primary);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .category-manager {
            margin-top: 30px;
            position: relative;
        }

        .category-form {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .category-form {
                flex-direction: column;
            }
            
            .goal-form {
                flex-direction: column;
            }
            
            .category-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .category-actions {
                width: 100%;
                justify-content: space-between;
            }
        }

        .category-form input {
            flex: 1;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
            min-width: 150px;
        }

        .dark-mode .category-form input {
            background-color: var(--light);
            border-color: #444;
            color: var(--text-primary);
        }

        .category-form input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .category-list {
            list-style: none;
        }

        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid #eee;
            transition: var(--transition);
        }

        .dark-mode .category-item {
            border-bottom: 1px solid #333;
        }

        .category-item:hover {
            background-color: rgba(0,0,0,0.03);
        }

        .dark-mode .category-item:hover {
            background-color: rgba(255,255,255,0.05);
        }

        .category-actions {
            display: flex;
            gap: 10px;
        }

        .category-actions button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .percentage-summary {
            background-color: var(--light);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 20px;
            text-align: center;
            font-weight: 600;
        }

        .dark-mode .percentage-summary {
            background-color: #2d2d2d;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .dark-mode .alert-warning {
            background-color: #332701;
            color: #fef5c4;
            border: 1px solid #5c4f02;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .dark-mode .alert-success {
            background-color: #032311;
            color: #b8eac8;
            border: 1px solid #034b25;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 50px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .empty-state p {
            font-size: 18px;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 8px;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--dark);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
            font-weight: normal;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--dark) transparent transparent transparent;
        }

        .visualization-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: var(--light);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
        }

        .pdf-btn {
            margin-left: auto;
        }

        .time-period-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .time-period-selector select {
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            background-color: var(--card-bg);
            color: var(--text-primary);
        }

        .dark-mode .time-period-selector select {
            background-color: var(--light);
            border-color: #444;
        }

        .goal-form {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .goal-form input {
            flex: 1;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
            min-width: 150px;
        }

        .dark-mode .goal-form input {
            background-color: var(--light);
            border-color: #444;
            color: var(--text-primary);
        }

        .goal-form input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .goal-item {
            padding: 16px 20px;
            border-bottom: 1px solid #eee;
            transition: var(--transition);
        }

        .dark-mode .goal-item {
            border-bottom: 1px solid #333;
        }

        .goal-item:hover {
            background-color: rgba(0,0,0,0.03);
        }

        .dark-mode .goal-item:hover {
            background-color: rgba(255,255,255,0.05);
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            transform: translateY(100px);
            opacity: 0;
        }

        .notification-success {
            background-color: #27ae60;
        }

        .notification-error {
            background-color: #e74c3c;
        }

        .introjs-tooltip {
            border-radius: 12px;
            box-shadow: var(--box-shadow);
        }

        .introjs-button {
            border-radius: 8px;
            padding: 8px 16px;
            text-shadow: none;
            background: var(--primary);
            color: white;
        }

        .introjs-button:hover {
            background: var(--primary-dark);
            box-shadow: none;
        }

        .introjs-bullets ul li a {
            background: #ccc;
        }

        .introjs-bullets ul li a.active {
            background: var(--primary);
        }

        /* Focus styles for accessibility */
        button:focus, input:focus, select:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
            font-size: 24px;
            flex-direction: column;
            gap: 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Custom Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transform: translateY(-50px);
            transition: transform 0.3s ease;
            overflow: hidden;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dark-mode .modal-header {
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-primary);
        }

        .modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid rgba(0,0,0,0.1);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .dark-mode .modal-footer {
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        /* Calculator Styles */
        .calculator {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .calculator-display {
            grid-column: span 4;
            padding: 15px;
            background: var(--light);
            border-radius: 8px;
            text-align: right;
            font-size: 24px;
            font-weight: 600;
            min-height: 60px;
        }

        .dark-mode .calculator-display {
            background: #2d2d2d;
        }

        .calculator-btn {
            padding: 15px;
            border: none;
            border-radius: 8px;
            background: var(--light);
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .dark-mode .calculator-btn {
            background: #2d2d2d;
        }

        .calculator-btn:hover {
            background: var(--primary);
            color: white;
        }

        .calculator-btn.operator {
            background: var(--primary);
            color: white;
        }

        .calculator-btn.operator:hover {
            background: var(--primary-dark);
        }

        .calculator-btn.equals {
            background: var(--success);
            color: white;
        }

        .calculator-btn.equals:hover {
            background: #27ae60;
        }

        .calculator-btn.clear {
            background: var(--danger);
            color: white;
        }

        .calculator-btn.clear:hover {
            background: #c0392b;
        }

        /* Expense List Styles */
        .expense-list {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .expense-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            transition: var(--transition);
        }

        .dark-mode .expense-item {
            border-bottom: 1px solid #333;
        }

        .expense-item:hover {
            background-color: rgba(0,0,0,0.03);
        }

        .dark-mode .expense-item:hover {
            background-color: rgba(255,255,255,0.05);
        }

        .expense-details {
            flex: 1;
        }

        .expense-category {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .expense-date {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .expense-amount {
            font-weight: 600;
            margin-right: 15px;
        }

        .expense-actions {
            display: flex;
            gap: 8px;
        }

        /* New Budget Modal Styles */
        .new-budget-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
        }

        .new-budget-option {
            padding: 15px;
            border: 2px solid #eee;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .dark-mode .new-budget-option {
            border-color: #444;
        }

        .new-budget-option:hover {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.05);
        }

        .new-budget-option.selected {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.1);
        }

        .new-budget-option h3 {
            margin-bottom: 8px;
            color: var(--primary);
        }

        .new-budget-option p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Mobile Responsiveness Enhancements */
        @media (max-width: 480px) {
            .logo {
                font-size: 20px;
            }
            
            .logo i {
                font-size: 24px;
            }
            
            .header-btn {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .theme-toggle {
                padding: 8px 16px;
            }
            
            .motivation-quote {
                font-size: 18px;
            }
            
            .card {
                padding: 20px;
            }
            
            .calculator-btn {
                padding: 12px;
                font-size: 16px;
            }
            
            .modal {
                width: 95%;
            }
            
            .expense-form {
                grid-template-columns: 1fr;
            }
            
            .income-input {
                flex-direction: column;
            }
            
            .category-form, .goal-form {
                flex-direction: column;
            }
        }

        /* Expense Edit Form */
        .expense-edit-form {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            padding: 10px;
            background: var(--light);
            border-radius: 8px;
        }

        .dark-mode .expense-edit-form {
            background: #2d2d2d;
        }

        .expense-edit-form input,
        .expense-edit-form select {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .dark-mode .expense-edit-form input,
        .dark-mode .expense-edit-form select {
            background-color: var(--card-bg);
            border-color: #444;
            color: var(--text-primary);
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div>Loading your financial data...</div>
    </div>

    <!-- Custom Modal Container -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal" id="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Modal Title</h2>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Modal content will be inserted here -->
            </div>
            <div class="modal-footer" id="modalFooter">
                <!-- Modal buttons will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Background Animation -->
    <div class="bg-animation">
        <div class="bg-circle"></div>
        <div class="bg-circle"></div>
        <div class="bg-circle"></div>
        <div class="bg-circle"></div>
    </div>

    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-chart-pie"></i>
                Smart Income & Budgeting Tracker
            </div>
            <div class="header-controls">
                <button class="header-btn" id="calculatorBtn">
                    <i class="fas fa-calculator"></i> Calculator
                </button>
                <button class="header-btn" id="newBudgetBtn">
                    <i class="fas fa-file-alt"></i> New Budget
                </button>
                <button class="header-btn" id="exportDataBtn">
                    <i class="fas fa-download"></i> Export Data
                </button>
                <button class="header-btn" id="importDataBtn">
                    <i class="fas fa-upload"></i> Import Data
                </button>
                <button class="header-btn" id="helpBtn">
                    <i class="fas fa-question-circle"></i> Help
                </button>
                <button class="theme-toggle" id="themeToggle">
                    <span id="themeIcon">ðŸŒ™</span>
                    <span id="themeText">Dark Mode</span>
                </button>
            </div>
            <input type="file" id="importFileInput" style="display: none;" accept=".json">
        </header>

        <section class="motivation-section">
            <div class="motivation-quote" id="motivationQuote">
                "Don't save what is left after spending, spend what is left after saving."
            </div>
            <div class="motivation-author" id="motivationAuthor">- Warren Buffett</div>
            <div class="motivation-question" id="motivationQuestion">
                Where is your money going?
            </div>
        </section>

        <div class="dashboard-grid">
            <div class="left-column">
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-money-bill-wave"></i>
                        Monthly Income
                    </div>
                    <div class="income-input">
                        <input type="number" id="incomeInput" placeholder="Enter your monthly income">
                        <button class="btn" id="setIncomeBtn">
                            <i class="fas fa-check"></i> Set Income
                        </button>
                    </div>
                    
                    <div class="card-title">
                        <i class="fas fa-chart-pie"></i>
                        Recommended Budget Allocation
                        <div class="tooltip">
                            <i class="fas fa-question-circle"></i>
                            <span class="tooltiptext">These are recommended percentages. You can customize them in the Category Manager.</span>
                        </div>
                    </div>
                    
                    <div id="percentageAlert" class="alert alert-warning" style="display: none;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span id="percentageAlertText"></span>
                    </div>
                    
                    <table class="budget-table">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Percentage</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody id="budgetTableBody">
                            <!-- Budget items will be populated here -->
                        </tbody>
                    </table>
                    
                    <div class="percentage-summary">
                        Total Allocated: <span id="totalPercentage">0</span>%
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-receipt"></i>
                        Track Your Expenses
                    </div>
                    <div class="expense-form">
                        <select id="expenseCategory">
                            <option value="">Select Category</option>
                            <!-- Categories will be populated here -->
                        </select>
                        <input type="number" id="expenseAmount" placeholder="Amount">
                        <button class="btn" id="addExpenseBtn">
                            <i class="fas fa-plus"></i> Add Expense
                        </button>
                    </div>
                    
                    <div class="card-title">
                        <i class="fas fa-list"></i>
                        Recent Expenses
                    </div>
                    <div class="expense-list" id="expenseList">
                        <!-- Expense list will be populated here -->
                    </div>
                    
                    <div class="card-title">
                        <i class="fas fa-tachometer-alt"></i>
                        Spending Progress
                    </div>
                    <div id="expenseProgress">
                        <!-- Progress bars will be populated here -->
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-bullseye"></i>
                        Savings Goals
                    </div>
                    <div class="goal-form">
                        <input type="text" id="goalName" placeholder="Goal name">
                        <input type="number" id="goalTarget" placeholder="Target amount">
                        <button class="btn btn-success" id="addGoalBtn">
                            <i class="fas fa-plus"></i> Add Goal
                        </button>
                    </div>
                    <div id="goalsList">
                        <!-- Goals will be listed here -->
                    </div>
                </div>

                <div class="card category-manager">
                    <div class="card-title">
                        <i class="fas fa-cogs"></i>
                        Category Manager
                    </div>
                    <div class="category-form">
                        <input type="text" id="newCategoryName" placeholder="New category name">
                        <input type="number" id="newCategoryPercent" placeholder="Percentage" min="0" max="100" step="0.5">
                        <button class="btn btn-success" id="addCategoryBtn">
                            <i class="fas fa-plus"></i> Add Category
                        </button>
                    </div>
                    <ul class="category-list" id="categoryList">
                        <!-- Categories will be listed here -->
                    </ul>
                </div>
            </div>

            <div class="right-column">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-chart-bar"></i>
                            Spending Overview
                        </div>
                        <div class="chart-toggle">
                            <button class="chart-toggle-btn active" data-chart="bar">Bars</button>
                            <button class="chart-toggle-btn" data-chart="pie">Pie</button>
                            <button class="chart-toggle-btn" data-chart="line">Trends</button>
                        </div>
                    </div>
                    <div class="time-period-selector">
                        <label for="timePeriod">View:</label>
                        <select id="timePeriod">
                            <option value="monthly" selected>Monthly</option>
                            <option value="quarterly">Quarterly</option>
                            <option value="yearly">Yearly</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="spendingChart"></canvas>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Total Income</div>
                            <div class="stat-value" id="totalIncome">â‚¹0</div>
                            <div class="stat-label">This Month</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Total Spent</div>
                            <div class="stat-value" id="totalSpent">â‚¹0</div>
                            <div class="stat-label">This Month</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Savings</div>
                            <div class="stat-value" id="savings">â‚¹0</div>
                            <div class="stat-label">This Month</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-file-alt"></i>
                            Monthly Report
                        </div>
                        <button class="btn btn-outline btn-sm pdf-btn" id="downloadPdfBtn">
                            <i class="fas fa-download"></i> Download PDF
                        </button>
                    </div>
                    <div id="reportEmptyState" class="empty-state" style="display: none;">
                        <i class="fas fa-clipboard-list"></i>
                        <p>No expense data available. Add expenses to see your report.</p>
                    </div>
                    <table class="report-table" id="reportTable">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Recommended %</th>
                                <th>Recommended Amount</th>
                                <th>Actual Amount</th>
                                <th>Difference</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="reportTableBody">
                            <!-- Report data will be populated here -->
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-chart-line"></i>
                        Expense Trends
                    </div>
                    <div class="chart-container">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let userData = {
            income: 0,
            expenses: [],
            categories: [
                { name: "Investments", percentage: 30 },
                { name: "Rent", percentage: 25 },
                { name: "Groceries & Food", percentage: 15 },
                { name: "Credit Repayment", percentage: 10 },
                { name: "Travel", percentage: 5 },
                { name: "Clothing", percentage: 3 },
                { name: "Cash Withdrawal", percentage: 3 },
                { name: "Miscellaneous", percentage: 4 },
                { name: "Alcohol", percentage: 2 },
                { name: "Games", percentage: 0.5 },
                { name: "Cigarettes", percentage: 0.5 },
                { name: "Subscriptions", percentage: 2 }
            ],
            goals: []
        };

        // DOM Elements
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const themeText = document.getElementById('themeText');
        const motivationQuote = document.getElementById('motivationQuote');
        const motivationAuthor = document.getElementById('motivationAuthor');
        const motivationQuestion = document.getElementById('motivationQuestion');
        const incomeInput = document.getElementById('incomeInput');
        const setIncomeBtn = document.getElementById('setIncomeBtn');
        const budgetTableBody = document.getElementById('budgetTableBody');
        const expenseCategory = document.getElementById('expenseCategory');
        const expenseAmount = document.getElementById('expenseAmount');
        const addExpenseBtn = document.getElementById('addExpenseBtn');
        const expenseProgress = document.getElementById('expenseProgress');
        const expenseList = document.getElementById('expenseList');
        const totalIncome = document.getElementById('totalIncome');
        const totalSpent = document.getElementById('totalSpent');
        const savings = document.getElementById('savings');
        const reportTableBody = document.getElementById('reportTableBody');
        const reportTable = document.getElementById('reportTable');
        const reportEmptyState = document.getElementById('reportEmptyState');
        const newCategoryName = document.getElementById('newCategoryName');
        const newCategoryPercent = document.getElementById('newCategoryPercent');
        const addCategoryBtn = document.getElementById('addCategoryBtn');
        const categoryList = document.getElementById('categoryList');
        const totalPercentage = document.getElementById('totalPercentage');
        const percentageAlert = document.getElementById('percentageAlert');
        const percentageAlertText = document.getElementById('percentageAlertText');
        const downloadPdfBtn = document.getElementById('downloadPdfBtn');
        const chartToggleBtns = document.querySelectorAll('.chart-toggle-btn');
        const timePeriodSelector = document.getElementById('timePeriod');
        const exportDataBtn = document.getElementById('exportDataBtn');
        const importDataBtn = document.getElementById('importDataBtn');
        const importFileInput = document.getElementById('importFileInput');
        const helpBtn = document.getElementById('helpBtn');
        const goalName = document.getElementById('goalName');
        const goalTarget = document.getElementById('goalTarget');
        const addGoalBtn = document.getElementById('addGoalBtn');
        const goalsList = document.getElementById('goalsList');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const calculatorBtn = document.getElementById('calculatorBtn');
        const newBudgetBtn = document.getElementById('newBudgetBtn');
        const modalOverlay = document.getElementById('modalOverlay');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        const modalFooter = document.getElementById('modalFooter');
        const modalClose = document.getElementById('modalClose');

        // Motivational quotes and questions
        const quotes = [
            { text: "Don't save what is left after spending, spend what is left after saving.", author: "Warren Buffett" },
            { text: "Small daily savings lead to big financial freedom.", author: "Chris Hogan" },
            { text: "Your money should work for you, not against you.", author: "Robert Kiyosaki" },
            { text: "Wealth is not about having a lot of money; it's about having a lot of options.", author: "Chris Rock" },
            { text: "Financial freedom is available to those who learn about it and work for it.", author: "Dave Ramsey" },
            { text: "The goal isn't more money. The goal is living life on your terms.", author: "Unknown" },
            { text: "Every rupee you save is a rupee you earn.", author: "Unknown" }
        ];

        const questions = [
            "Where is your money going?",
            "Where should your money go?",
            "Are you on track with your spends?",
            "What financial goals are you working towards?",
            "How can you make your money work harder for you?",
            "What spending could you reduce without impacting your quality of life?"
        ];

        // Charts
        let spendingChart = null;
        let trendChart = null;
        let currentChartType = 'bar';

        // Initialize the application
        function init() {
            // Show loading overlay initially
            loadingOverlay.style.display = 'flex';
            
            setTimeout(() => {
                loadData();
                updateUI();
                setupEventListeners();
                rotateMotivationalContent();
                
                // Check if dark mode was previously enabled
                if (localStorage.getItem('darkMode') === 'enabled') {
                    document.body.classList.add('dark-mode');
                    themeIcon.textContent = 'â˜€ï¸';
                    themeText.textContent = 'Light Mode';
                }
                
                // Hide loading overlay
                loadingOverlay.style.display = 'none';
                
                // Request notification permission
                if ('Notification' in window && Notification.permission === 'default') {
                    Notification.requestPermission();
                }
            }, 1000);
        }

        // Load data from localStorage
        function loadData() {
            const savedData = localStorage.getItem('budgetTrackerData');
            if (savedData) {
                try {
                    userData = JSON.parse(savedData);
                    // Update the income input field
                    incomeInput.value = userData.income > 0 ? userData.income : '';
                } catch (e) {
                    console.error("Error parsing saved data:", e);
                    // Reset to default if there's an error
                    localStorage.removeItem('budgetTrackerData');
                }
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('budgetTrackerData', JSON.stringify(userData));
        }

        // Set up event listeners
        function setupEventListeners() {
            themeToggle.addEventListener('click', toggleDarkMode);
            setIncomeBtn.addEventListener('click', setIncome);
            addExpenseBtn.addEventListener('click', addExpense);
            addCategoryBtn.addEventListener('click', addCategory);
            downloadPdfBtn.addEventListener('click', downloadPDF);
            timePeriodSelector.addEventListener('change', updateUI);
            exportDataBtn.addEventListener('click', exportData);
            importDataBtn.addEventListener('click', triggerImport);
            importFileInput.addEventListener('change', importData);
            helpBtn.addEventListener('click', startTutorial);
            addGoalBtn.addEventListener('click', addGoal);
            calculatorBtn.addEventListener('click', showCalculator);
            newBudgetBtn.addEventListener('click', showNewBudgetModal);
            modalClose.addEventListener('click', hideModal);
            
            // Allow pressing Enter in input fields
            incomeInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') setIncome();
            });
            
            expenseAmount.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addExpense();
            });
            
            newCategoryName.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addCategory();
            });
            
            newCategoryPercent.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addCategory();
            });
            
            goalName.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addGoal();
            });
            
            goalTarget.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addGoal();
            });

            // Chart type toggle
            chartToggleBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    chartToggleBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentChartType = btn.dataset.chart;
                    updateCharts();
                });
            });
        }

        // Show custom modal
        function showModal(title, bodyContent, footerButtons = []) {
            modalTitle.textContent = title;
            modalBody.innerHTML = bodyContent;
            
            // Clear previous footer buttons
            modalFooter.innerHTML = '';
            
            // Add new footer buttons if provided
            if (footerButtons.length > 0) {
                footerButtons.forEach(button => {
                    const btn = document.createElement('button');
                    btn.className = button.class || 'btn';
                    btn.textContent = button.text;
                    btn.onclick = button.action;
                    modalFooter.appendChild(btn);
                });
            } else {
                // Add default close button
                const closeBtn = document.createElement('button');
                closeBtn.className = 'btn';
                closeBtn.textContent = 'Close';
                closeBtn.onclick = hideModal;
                modalFooter.appendChild(closeBtn);
            }
            
            // Show the modal
            modalOverlay.classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent scrolling
        }

        // Hide modal
        function hideModal() {
            modalOverlay.classList.remove('active');
            document.body.style.overflow = ''; // Re-enable scrolling
        }

        // Show calculator modal
        function showCalculator() {
            const calculatorHTML = `
                <div class="calculator-display" id="calcDisplay">0</div>
                <div class="calculator">
                    <button class="calculator-btn clear" onclick="clearCalculator()">C</button>
                    <button class="calculator-btn operator" onclick="appendToCalculator('Ã·')">/</button>
                    <button class="calculator-btn operator" onclick="appendToCalculator('Ã—')">Ã—</button>
                    <button class="calculator-btn operator" onclick="appendToCalculator('-')">-</button>
                    
                    <button class="calculator-btn" onclick="appendToCalculator('7')">7</button>
                    <button class="calculator-btn" onclick="appendToCalculator('8')">8</button>
                    <button class="calculator-btn" onclick="appendToCalculator('9')">9</button>
                    <button class="calculator-btn operator" onclick="appendToCalculator('+')">+</button>
                    
                    <button class="calculator-btn" onclick="appendToCalculator('4')">4</button>
                    <button class="calculator-btn" onclick="appendToCalculator('5')">5</button>
                    <button class="calculator-btn" onclick="appendToCalculator('6')">6</button>
                    <button class="calculator-btn equals" onclick="calculateResult()" style="grid-row: span 2;">=</button>
                    
                    <button class="calculator-btn" onclick="appendToCalculator('1')">1</button>
                    <button class="calculator-btn" onclick="appendToCalculator('2')">2</button>
                    <button class="calculator-btn" onclick="appendToCalculator('3')">3</button>
                    
                    <button class="calculator-btn" onclick="appendToCalculator('0')" style="grid-column: span 2;">0</button>
                    <button class="calculator-btn" onclick="appendToCalculator('.')">.</button>
                </div>
            `;
            
            showModal('Calculator', calculatorHTML);
        }

        // Calculator functions
        function appendToCalculator(value) {
            const display = document.getElementById('calcDisplay');
            if (display.textContent === '0' && value !== '.') {
                display.textContent = value;
            } else {
                display.textContent += value;
            }
        }

        function clearCalculator() {
            document.getElementById('calcDisplay').textContent = '0';
        }

        function calculateResult() {
            const display = document.getElementById('calcDisplay');
            try {
                // Replace Ã— with * and Ã· with / for evaluation
                let expression = display.textContent.replace(/Ã—/g, '*').replace(/Ã·/g, '/');
                const result = eval(expression);
                display.textContent = result;
            } catch (e) {
                display.textContent = 'Error';
            }
        }

        // Show new budget modal
        function showNewBudgetModal() {
            const newBudgetHTML = `
                <p>Starting a new budget will clear all your current data. Would you like to export your current data before starting fresh?</p>
                <div class="new-budget-options">
                    <div class="new-budget-option" onclick="selectOption(this)">
                        <h3>Export and Start New</h3>
                        <p>Export your current data as a backup and then start with a fresh budget.</p>
                    </div>
                    <div class="new-budget-option" onclick="selectOption(this)">
                        <h3>Start Fresh</h3>
                        <p>Clear all data and start with a new budget. This cannot be undone.</p>
                    </div>
                </div>
            `;
            
            const footerButtons = [
                {
                    text: 'Cancel',
                    class: 'btn btn-outline',
                    action: hideModal
                },
                {
                    text: 'Continue',
                    class: 'btn',
                    action: processNewBudget
                }
            ];
            
            showModal('Start New Budget', newBudgetHTML, footerButtons);
        }

        // Select option in new budget modal
        function selectOption(element) {
            document.querySelectorAll('.new-budget-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            element.classList.add('selected');
        }

        // Process new budget creation
        function processNewBudget() {
            const selectedOption = document.querySelector('.new-budget-option.selected');
            if (!selectedOption) {
                showNotification('Please select an option', 'error');
                return;
            }
            
            if (selectedOption.textContent.includes('Export')) {
                exportData();
            }
            
            // Clear all data
            userData = {
                income: 0,
                expenses: [],
                categories: [
                    { name: "Investments", percentage: 30 },
                    { name: "Rent", percentage: 25 },
                    { name: "Groceries & Food", percentage: 15 },
                    { name: "Credit Repayment", percentage: 10 },
                    { name: "Travel", percentage: 5 },
                    { name: "Clothing", percentage: 3 },
                    { name: "Cash Withdrawal", percentage: 3 },
                    { name: "Miscellaneous", percentage: 4 },
                    { name: "Alcohol", percentage: 2 },
                    { name: "Games", percentage: 0.5 },
                    { name: "Cigarettes", percentage: 0.5 },
                    { name: "Subscriptions", percentage: 2 }
                ],
                goals: []
            };
            
            incomeInput.value = '';
            saveData();
            updateUI();
            hideModal();
            
            showNotification('New budget started successfully', 'success');
        }

        // Toggle dark mode
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            if (document.body.classList.contains('dark-mode')) {
                themeIcon.textContent = 'â˜€ï¸';
                themeText.textContent = 'Light Mode';
                localStorage.setItem('darkMode', 'enabled');
            } else {
                themeIcon.textContent = 'ðŸŒ™';
                themeText.textContent = 'Dark Mode';
                localStorage.setItem('darkMode', 'disabled');
            }
            // Update charts to reflect theme changes
            updateCharts();
        }

        // Set monthly income
        function setIncome() {
            const income = parseFloat(incomeInput.value);
            if (isNaN(income) || income <= 0) {
                showNotification('Please enter a valid income amount', 'error');
                return;
            }

            userData.income = income;
            saveData();
            updateUI();
            
            // Show notification
            showNotification(`Income set to â‚¹${income.toLocaleString()}`, 'success');
        }

        // Add expense
        function addExpense() {
            const category = expenseCategory.value;
            const amount = parseFloat(expenseAmount.value);

            if (!category) {
                showNotification('Please select a category', 'error');
                return;
            }

            if (isNaN(amount) || amount <= 0) {
                showNotification('Please enter a valid amount', 'error');
                return;
            }

            userData.expenses.push({
                category,
                amount,
                date: new Date().toISOString(),
                id: Date.now() // Add unique ID for editing
            });

            saveData();
            updateUI();
            
            // Check for budget alerts
            checkBudgetAlerts(category, amount);
            
            // Show notification
            showNotification(`Added expense of â‚¹${amount.toLocaleString()} to ${category}`, 'success');
            
            // Reset form
            expenseAmount.value = '';
        }

        // Edit expense
        function editExpense(id) {
            const expense = userData.expenses.find(exp => exp.id === id);
            if (!expense) return;
            
            const editFormHTML = `
                <div class="expense-edit-form">
                    <select id="editExpenseCategory">
                        ${userData.categories.map(cat => 
                            `<option value="${cat.name}" ${cat.name === expense.category ? 'selected' : ''}>${cat.name}</option>`
                        ).join('')}
                    </select>
                    <input type="number" id="editExpenseAmount" value="${expense.amount}" placeholder="Amount">
                    <button class="btn btn-sm" onclick="saveExpenseEdit(${id})">Save</button>
                    <button class="btn btn-outline btn-sm" onclick="cancelEdit()">Cancel</button>
                </div>
            `;
            
            const expenseItem = document.getElementById(`expense-${id}`);
            expenseItem.insertAdjacentHTML('afterend', editFormHTML);
            expenseItem.style.display = 'none';
        }

        // Save expense edit
        function saveExpenseEdit(id) {
            const category = document.getElementById('editExpenseCategory').value;
            const amount = parseFloat(document.getElementById('editExpenseAmount').value);
            
            if (!category || isNaN(amount) || amount <= 0) {
                showNotification('Please enter valid expense details', 'error');
                return;
            }
            
            const expenseIndex = userData.expenses.findIndex(exp => exp.id === id);
            if (expenseIndex !== -1) {
                userData.expenses[expenseIndex].category = category;
                userData.expenses[expenseIndex].amount = amount;
                saveData();
                updateUI();
                showNotification('Expense updated successfully', 'success');
            }
        }

        // Cancel edit
        function cancelEdit() {
            updateUI();
        }

        // Delete expense
        function deleteExpense(id) {
            showConfirmModal(
                'Delete Expense',
                'Are you sure you want to delete this expense?',
                () => {
                    userData.expenses = userData.expenses.filter(exp => exp.id !== id);
                    saveData();
                    updateUI();
                    showNotification('Expense deleted successfully', 'success');
                }
            );
        }

        // Add new category
        function addCategory() {
            const name = newCategoryName.value.trim();
            const percentage = parseFloat(newCategoryPercent.value);

            if (!name) {
                showNotification('Please enter a category name', 'error');
                return;
            }

            if (isNaN(percentage) || percentage <= 0) {
                showNotification('Please enter a valid percentage', 'error');
                return;
            }

            // Check if category name already exists
            if (userData.categories.some(cat => cat.name.toLowerCase() === name.toLowerCase())) {
                showNotification('Category already exists', 'error');
                return;
            }

            // Check if total percentage exceeds 100%
            const currentTotal = calculateTotalPercentage();
            if (currentTotal + percentage > 100) {
                showNotification(`Total percentage cannot exceed 100%. Current total: ${currentTotal}%`, 'error');
                return;
            }

            userData.categories.push({ name, percentage });
            saveData();
            updateUI();
            
            // Show notification
            showNotification(`Added category: ${name} (${percentage}%)`, 'success');
            
            // Reset form
            newCategoryName.value = '';
            newCategoryPercent.value = '';
        }

        // Add new goal
        function addGoal() {
            const name = goalName.value.trim();
            const target = parseFloat(goalTarget.value);

            if (!name) {
                showNotification('Please enter a goal name', 'error');
                return;
            }

            if (isNaN(target) || target <= 0) {
                showNotification('Please enter a valid target amount', 'error');
                return;
            }

            userData.goals.push({
                name,
                target,
                createdAt: new Date().toISOString(),
                id: Date.now() // Add unique ID for deletion
            });

            saveData();
            updateGoalsList();
            
            // Show notification
            showNotification(`Added goal: ${name} (â‚¹${target.toLocaleString()})`, 'success');
            
            // Reset form
            goalName.value = '';
            goalTarget.value = '';
        }

        // Delete goal with confirmation
        function deleteGoal(id) {
            showConfirmModal(
                'Delete Goal',
                'Are you sure you want to delete this goal?',
                () => {
                    userData.goals = userData.goals.filter(goal => goal.id !== id);
                    saveData();
                    updateGoalsList();
                    showNotification('Goal deleted successfully', 'success');
                }
            );
        }

        // Show confirmation modal
        function showConfirmModal(title, message, confirmAction) {
            const confirmHTML = `
                <p>${message}</p>
            `;
            
            const footerButtons = [
                {
                    text: 'Cancel',
                    class: 'btn btn-outline',
                    action: hideModal
                },
                {
                    text: 'Confirm',
                    class: 'btn btn-danger',
                    action: () => {
                        confirmAction();
                        hideModal();
                    }
                }
            ];
            
            showModal(title, confirmHTML, footerButtons);
        }

        // Calculate total percentage allocated
        function calculateTotalPercentage() {
            return userData.categories.reduce((total, cat) => total + cat.percentage, 0);
        }

        // Show notification
        function showNotification(message, type) {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            
            if (type === 'success') {
                notification.style.backgroundColor = '#27ae60';
            } else {
                notification.style.backgroundColor = '#e74c3c';
            }
            
            // Add icon based on type
            const icon = document.createElement('i');
            icon.className = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
            notification.appendChild(icon);
            
            // Add message
            const messageEl = document.createElement('span');
            messageEl.textContent = message;
            notification.appendChild(messageEl);
            
            // Add to body
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateY(0)';
                notification.style.opacity = '1';
            }, 10);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.transform = 'translateY(100px)';
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Check for budget alerts
        function checkBudgetAlerts(category, amount) {
            if ('Notification' in window && Notification.permission === 'granted') {
                const categoryData = userData.categories.find(c => c.name === category);
                if (categoryData) {
                    const budgetAmount = userData.income * (categoryData.percentage / 100);
                    const categoryExpenses = userData.expenses
                        .filter(expense => expense.category === category)
                        .reduce((total, expense) => total + expense.amount, 0);
                    
                    const percentageSpent = budgetAmount > 0 ? (categoryExpenses / budgetAmount) * 100 : 0;
                    
                    if (percentageSpent > 100) {
                        new Notification('Budget Exceeded', {
                            body: `You've exceeded your ${category} budget by ${(percentageSpent - 100).toFixed(1)}%`,
                            icon: 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css'
                        });
                    } else if (percentageSpent > 80) {
                        new Notification('Budget Warning', {
                            body: `You've used ${percentageSpent.toFixed(1)}% of your ${category} budget`,
                            icon: 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css'
                        });
                    }
                }
            }
        }

        // Rotate motivational content
        function rotateMotivationalContent() {
            setInterval(() => {
                const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
                const randomQuestion = questions[Math.floor(Math.random() * questions.length)];
                
                motivationQuote.textContent = `"${randomQuote.text}"`;
                motivationAuthor.textContent = `- ${randomQuote.author}`;
                motivationQuestion.textContent = randomQuestion;
            }, 10000);
        }

        // Update the UI with current data
        function updateUI() {
            const timePeriod = timePeriodSelector.value;
            updateBudgetTable();
            updateCategoryDropdown();
            updateExpenseList();
            updateExpenseProgress(timePeriod);
            updateCharts(timePeriod);
            updateStats(timePeriod);
            updateReportTable(timePeriod);
            updateCategoryList();
            updatePercentageSummary();
            updateGoalsList();
        }

        // Update budget table
        function updateBudgetTable() {
            budgetTableBody.innerHTML = '';
            
            userData.categories.forEach(category => {
                const amount = userData.income * (category.percentage / 100);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${category.name}</td>
                    <td>${category.percentage}%</td>
                    <td>â‚¹${amount.toFixed(2)}</td>
                `;
                
                budgetTableBody.appendChild(row);
            });
        }

        // Update category dropdown
        function updateCategoryDropdown() {
            expenseCategory.innerHTML = '<option value="">Select Category</option>';
            
            userData.categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.name;
                option.textContent = category.name;
                expenseCategory.appendChild(option);
            });
        }

        // Update expense list
        function updateExpenseList() {
            expenseList.innerHTML = '';
            
            if (userData.expenses.length === 0) {
                expenseList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-receipt"></i>
                        <p>No expenses yet. Add expenses to track your spending.</p>
                    </div>
                `;
                return;
            }
            
            // Show only recent expenses (last 10)
            const recentExpenses = [...userData.expenses]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 10);
            
            recentExpenses.forEach(expense => {
                const date = new Date(expense.date);
                const formattedDate = date.toLocaleDateString();
                
                const expenseEl = document.createElement('div');
                expenseEl.className = 'expense-item';
                expenseEl.id = `expense-${expense.id}`;
                expenseEl.innerHTML = `
                    <div class="expense-details">
                        <div class="expense-category">${expense.category}</div>
                        <div class="expense-date">${formattedDate}</div>
                    </div>
                    <div class="expense-amount">â‚¹${expense.amount.toFixed(2)}</div>
                    <div class="expense-actions">
                        <button class="btn btn-warning btn-sm" onclick="editExpense(${expense.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteExpense(${expense.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                expenseList.appendChild(expenseEl);
            });
        }

        // Filter expenses by time period
        function filterExpensesByTimePeriod(expenses, timePeriod) {
            const now = new Date();
            let startDate;
            
            switch(timePeriod) {
                case 'monthly':
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                    break;
                case 'quarterly':
                    const quarter = Math.floor(now.getMonth() / 3);
                    startDate = new Date(now.getFullYear(), quarter * 3, 1);
                    break;
                case 'yearly':
                    startDate = new Date(now.getFullYear(), 0, 1);
                    break;
                default:
                    return expenses;
            }
            
            return expenses.filter(expense => {
                const expenseDate = new Date(expense.date);
                return expenseDate >= startDate;
            });
        }

        // Update expense progress
        function updateExpenseProgress(timePeriod = 'monthly') {
            expenseProgress.innerHTML = '';
            
            if (userData.income <= 0) {
                expenseProgress.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-coins"></i>
                        <p>Set your monthly income to see spending progress</p>
                    </div>
                `;
                return;
            }
            
            const filteredExpenses = filterExpensesByTimePeriod(userData.expenses, timePeriod);
            
            if (filteredExpenses.length === 0) {
                expenseProgress.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-receipt"></i>
                        <p>No expenses yet. Add expenses to track your spending.</p>
                    </div>
                `;
                return;
            }
            
            userData.categories.forEach(category => {
                const categoryExpenses = filteredExpenses
                    .filter(expense => expense.category === category.name)
                    .reduce((total, expense) => total + expense.amount, 0);
                
                const budgetAmount = userData.income * (category.percentage / 100);
                const percentageSpent = budgetAmount > 0 ? (categoryExpenses / budgetAmount) * 100 : 0;
                
                const progressContainer = document.createElement('div');
                progressContainer.innerHTML = `
                    <div style="display: flex; justify-content: space-between; margin-top: 15px;">
                        <span>${category.name}</span>
                        <span>â‚¹${categoryExpenses.toFixed(2)} / â‚¹${budgetAmount.toFixed(2)}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-bar-fill" style="width: ${Math.min(percentageSpent, 100)}%; background-color: ${percentageSpent > 100 ? '#e74c3c' : '#4361ee'}"></div>
                    </div>
                    ${percentageSpent > 100 ? 
                        `<div class="danger"><i class="fas fa-exclamation-circle"></i> You've exceeded your ${category.name} budget by ${(percentageSpent - 100).toFixed(1)}%</div>` : 
                        percentageSpent > 80 ?
                        `<div class="warning"><i class="fas fa-exclamation-triangle"></i> You've used ${percentageSpent.toFixed(1)}% of your ${category.name} budget</div>` :
                        percentageSpent > 0 ?
                        `<div class="success"><i class="fas fa-check-circle"></i> You've used ${percentageSpent.toFixed(1)}% of your ${category.name} budget</div>` : ''
                    }
                `;
                
                expenseProgress.appendChild(progressContainer);
            });
        }

        // Update charts
        function updateCharts(timePeriod = 'monthly') {
            const ctx = document.getElementById('spendingChart');
            const trendCtx = document.getElementById('trendChart');
            
            // Destroy previous charts if they exist
            if (spendingChart) {
                spendingChart.destroy();
            }
            
            if (trendChart) {
                trendChart.destroy();
            }
            
            // Prepare data for charts
            const categories = userData.categories.map(c => c.name);
            const recommendedAmounts = userData.categories.map(c => userData.income * (c.percentage / 100));
            
            const filteredExpenses = filterExpensesByTimePeriod(userData.expenses, timePeriod);
            
            const actualAmounts = userData.categories.map(category => {
                return filteredExpenses
                    .filter(expense => expense.category === category.name)
                    .reduce((total, expense) => total + expense.amount, 0);
            });

            // Prepare trend data (last 6 months)
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const currentMonth = new Date().getMonth();
            const monthLabels = [];
            for (let i = 5; i >= 0; i--) {
                const monthIndex = (currentMonth - i + 12) % 12;
                monthLabels.push(months[monthIndex]);
            }

            // For demonstration, we'll generate random trend data
            // In a real app, you would use actual historical data
            const trendData = [];
            for (let i = 0; i < 6; i++) {
                trendData.push(Math.random() * userData.income * 0.8);
            }
            
            // Create spending chart based on current type
            if (currentChartType === 'bar') {
                spendingChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: categories,
                        datasets: [
                            {
                                label: 'Recommended',
                                data: recommendedAmounts,
                                backgroundColor: 'rgba(67, 97, 238, 0.7)',
                                borderColor: 'rgba(67, 97, 238, 1)',
                                borderWidth: 1
                            },
                            {
                                label: 'Actual',
                                data: actualAmounts,
                                backgroundColor: 'rgba(247, 37, 133, 0.7)',
                                borderColor: 'rgba(247, 37, 133, 1)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'â‚¹' + value.toLocaleString();
                                    }
                                }
                            },
                            x: {
                                ticks: {
                                    maxRotation: 45,
                                    minRotation: 45
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': â‚¹' + context.raw.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
            } else if (currentChartType === 'pie') {
                spendingChart = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: categories,
                        datasets: [{
                            data: actualAmounts,
                            backgroundColor: [
                                'rgba(67, 97, 238, 0.7)',
                                'rgba(247, 37, 133, 0.7)',
                                'rgba(76, 201, 240, 0.7)',
                                'rgba(114, 9, 183, 0.7)',
                                'rgba(46, 204, 113, 0.7)',
                                'rgba(243, 156, 18, 0.7)',
                                'rgba(231, 76, 60, 0.7)',
                                'rgba(155, 89, 182, 0.7)',
                                'rgba(241, 196, 15, 0.7)',
                                'rgba(52, 152, 219, 0.7)',
                                'rgba(230, 126, 34, 0.7)',
                                'rgba(149, 165, 166, 0.7)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    boxWidth: 15
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.label + ': â‚¹' + context.raw.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
            } else if (currentChartType === 'line') {
                spendingChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: monthLabels,
                        datasets: [{
                            label: 'Monthly Spending',
                            data: trendData,
                            backgroundColor: 'rgba(67, 97, 238, 0.2)',
                            borderColor: 'rgba(67, 97, 238, 1)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'â‚¹' + value.toLocaleString();
                                    }
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return 'Spent: â‚¹' + context.raw.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Create trend chart (always line chart)
            trendChart = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: monthLabels,
                    datasets: [{
                        label: 'Income',
                        data: Array(6).fill(userData.income),
                        backgroundColor: 'rgba(46, 204, 113, 0.2)',
                        borderColor: 'rgba(46, 204, 113, 1)',
                        borderWidth: 2,
                        tension: 0.1,
                        fill: true
                    }, {
                        label: 'Expenses',
                        data: trendData,
                        backgroundColor: 'rgba(231, 76, 60, 0.2)',
                        borderColor: 'rgba(231, 76, 60, 1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'â‚¹' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': â‚¹' + context.raw.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update stats
        function updateStats(timePeriod = 'monthly') {
            const filteredExpenses = filterExpensesByTimePeriod(userData.expenses, timePeriod);
            
            const total = userData.income;
            const spent = filteredExpenses.reduce((total, expense) => total + expense.amount, 0);
            const saving = total - spent;
            
            totalIncome.textContent = `â‚¹${total.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            totalSpent.textContent = `â‚¹${spent.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            savings.textContent = `â‚¹${saving.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            
            // Update savings color based on value
            if (saving < 0) {
                savings.style.color = '#e74c3c';
            } else {
                savings.style.color = '#ffffff';
            }
        }

        // Update report table
        function updateReportTable(timePeriod = 'monthly') {
            reportTableBody.innerHTML = '';
            
            const filteredExpenses = filterExpensesByTimePeriod(userData.expenses, timePeriod);
            
            if (filteredExpenses.length === 0) {
                reportTable.style.display = 'none';
                reportEmptyState.style.display = 'block';
                return;
            }
            
            reportTable.style.display = 'table';
            reportEmptyState.style.display = 'none';
            
            userData.categories.forEach(category => {
                const recommendedAmount = userData.income * (category.percentage / 100);
                const actualAmount = filteredExpenses
                    .filter(expense => expense.category === category.name)
                    .reduce((total, expense) => total + expense.amount, 0);
                
                const difference = actualAmount - recommendedAmount;
                const differencePercent = recommendedAmount > 0 ? (difference / recommendedAmount) * 100 : 0;
                
                let status = '';
                let statusIcon = '';
                
                if (Math.abs(difference) < 1) { // Account for floating point imprecision
                    status = 'status-on-track';
                    statusIcon = '<i class="fas fa-check-circle"></i>';
                } else if (difference > 0) {
                    status = 'status-over';
                    statusIcon = '<i class="fas fa-exclamation-circle"></i>';
                } else {
                    status = 'status-under';
                    statusIcon = '<i class="fas fa-info-circle"></i>';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${category.name}</td>
                    <td>${category.percentage}%</td>
                    <td>â‚¹${recommendedAmount.toFixed(2)}</td>
                    <td>â‚¹${actualAmount.toFixed(2)}</td>
                    <td style="color: ${difference >= 0 ? '#e74c3c' : '#2ecc71'}">${difference >= 0 ? '+' : ''}â‚¹${difference.toFixed(2)} (${difference >= 0 ? '+' : ''}${differencePercent.toFixed(1)}%)</td>
                    <td class="${status}">${statusIcon} ${difference > 0 ? 'Over' : Math.abs(difference) < 1 ? 'On Track' : 'Under'}</td>
                `;
                
                reportTableBody.appendChild(row);
            });
        }

        // Update category list for management
        function updateCategoryList() {
            categoryList.innerHTML = '';
            
            if (userData.categories.length === 0) {
                categoryList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <p>No categories yet. Add categories to organize your budget.</p>
                    </div>
                `;
                return;
            }
            
            userData.categories.forEach((category, index) => {
                const li = document.createElement('li');
                li.className = 'category-item';
                li.innerHTML = `
                    <div>
                        <strong>${category.name}</strong> - ${category.percentage}%
                    </div>
                    <div class="category-actions">
                        <button class="btn btn-warning btn-sm btn-edit" data-index="${index}">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-danger btn-sm btn-delete" data-index="${index}">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                
                categoryList.appendChild(li);
            });
            
            // Add event listeners to edit and delete buttons
            document.querySelectorAll('.btn-edit').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = e.target.closest('.btn-edit').dataset.index;
                    editCategory(index);
                });
            });
            
            document.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = e.target.closest('.btn-delete').dataset.index;
                    deleteCategory(index);
                });
            });
        }

        // Update goals list
        function updateGoalsList() {
            goalsList.innerHTML = '';
            
            if (userData.goals.length === 0) {
                goalsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bullseye"></i>
                        <p>No goals yet. Add savings goals to track your progress.</p>
                    </div>
                `;
                return;
            }
            
            // Calculate total savings (income - expenses)
            const totalExpenses = userData.expenses.reduce((total, expense) => total + expense.amount, 0);
            const savings = userData.income - totalExpenses;
            
            userData.goals.forEach((goal) => {
                const progress = Math.min((savings / goal.target) * 100, 100);
                
                const goalEl = document.createElement('div');
                goalEl.className = 'goal-item';
                goalEl.innerHTML = `
                    <div style="display: flex; justify-content: space-between;">
                        <strong>${goal.name}</strong>
                        <span>â‚¹${savings.toFixed(2)} / â‚¹${goal.target.toFixed(2)}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-bar-fill" style="width: ${progress}%;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                        <span>${progress.toFixed(1)}%</span>
                        <button class="btn btn-danger btn-sm" onclick="deleteGoal(${goal.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                goalsList.appendChild(goalEl);
            });
        }

        // Update percentage summary
        function updatePercentageSummary() {
            const total = calculateTotalPercentage();
            totalPercentage.textContent = total.toFixed(1);
            
            if (total < 100) {
                percentageAlert.style.display = 'flex';
                percentageAlertText.textContent = `You have ${(100 - total).toFixed(1)}% of your income unallocated. Consider adding more categories or increasing existing ones.`;
            } else if (total > 100) {
                percentageAlert.style.display = 'flex';
                percentageAlertText.textContent = `You have allocated ${(total - 100).toFixed(1)}% more than your income. Please adjust your categories.`;
            } else {
                percentageAlert.style.display = 'none';
            }
        }

        // Edit category
        function editCategory(index) {
            const category = userData.categories[index];
            showModal(
                'Edit Category',
                `
                <p>Edit the percentage for ${category.name}</p>
                <div class="income-input">
                    <input type="number" id="editCategoryPercent" value="${category.percentage}" min="0" max="100" step="0.5">
                    <button class="btn" onclick="saveCategoryEdit(${index})">Save</button>
                </div>
                `,
                [
                    {
                        text: 'Cancel',
                        class: 'btn btn-outline',
                        action: hideModal
                    },
                    {
                        text: 'Save',
                        class: 'btn',
                        action: () => saveCategoryEdit(index)
                    }
                ]
            );
        }

        // Save category edit
        function saveCategoryEdit(index) {
            const newPercentage = parseFloat(document.getElementById('editCategoryPercent').value);
            
            if (isNaN(newPercentage) || newPercentage <= 0) {
                showNotification('Please enter a valid percentage', 'error');
                return;
            }
            
            // Check if total percentage exceeds 100%
            const currentTotal = calculateTotalPercentage();
            const newTotal = currentTotal - userData.categories[index].percentage + newPercentage;
            
            if (newTotal > 100) {
                showNotification(`Total percentage cannot exceed 100%. Current total would be: ${newTotal.toFixed(1)}%`, 'error');
                return;
            }
            
            userData.categories[index].percentage = newPercentage;
            saveData();
            updateUI();
            hideModal();
            
            // Show notification
            showNotification(`Updated ${userData.categories[index].name} to ${newPercentage}%`, 'success');
        }

        // Delete category
        function deleteCategory(index) {
            const category = userData.categories[index];
            
            // Check if there are expenses in this category
            const categoryExpenses = userData.expenses.filter(expense => expense.category === category.name);
            
            showConfirmModal(
                'Delete Category',
                categoryExpenses.length > 0 
                    ? `This category has ${categoryExpenses.length} expense(s). Deleting it will also remove these expenses. Are you sure you want to delete?`
                    : 'Are you sure you want to delete this category?',
                () => {
                    // Remove expenses in this category
                    userData.expenses = userData.expenses.filter(expense => expense.category !== category.name);
                    userData.categories.splice(index, 1);
                    saveData();
                    updateUI();
                    showNotification(`Deleted category: ${category.name}`, 'success');
                }
            );
        }

        // Export data
        function exportData() {
            const dataStr = JSON.stringify(userData);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `budget-data-${new Date().toISOString().slice(0, 10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Data exported successfully', 'success');
        }

        // Trigger import file selection
        function triggerImport() {
            importFileInput.click();
        }

        // Import data
        function importData(evt) {
            const file = evt.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Basic validation
                    if (!importedData.categories || !importedData.expenses || importedData.income === undefined) {
                        throw new Error('Invalid data format');
                    }
                    
                    showConfirmModal(
                        'Import Data',
                        'This will replace your current data. Are you sure you want to continue?',
                        () => {
                            userData = importedData;
                            saveData();
                            updateUI();
                            showNotification('Data imported successfully', 'success');
                        }
                    );
                } catch (error) {
                    showNotification('Error importing data: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            evt.target.value = '';
        }

        // Start tutorial
        function startTutorial() {
            introJs().setOptions({
                steps: [
                    {
                        element: document.querySelector('.logo'),
                        intro: 'Welcome to the Smart Income & Budgeting Tracker! This tutorial will guide you through the main features.'
                    },
                    {
                        element: document.getElementById('incomeInput'),
                        intro: 'Start by entering your monthly income here.'
                    },
                    {
                        element: document.getElementById('setIncomeBtn'),
                        intro: 'Click this button to set your income and see your recommended budget allocation.'
                    },
                    {
                        element: document.getElementById('expenseCategory'),
                        intro: 'Select a category for your expense.'
                    },
                    {
                        element: document.getElementById('expenseAmount'),
                        intro: 'Enter the amount you spent.'
                    },
                    {
                        element: document.getElementById('addExpenseBtn'),
                        intro: 'Click here to add your expense and track your spending.'
                    },
                    {
                        element: document.querySelector('.chart-container'),
                        intro: 'View visualizations of your spending patterns here.'
                    },
                    {
                        element: document.getElementById('downloadPdfBtn'),
                        intro: 'Generate a PDF report of your financial status anytime.'
                    },
                    {
                        element: document.getElementById('themeToggle'),
                        intro: 'Toggle between light and dark mode for comfortable viewing.'
                    },
                    {
                        element: document.getElementById('exportDataBtn'),
                        intro: 'Export your data to a JSON file for backup.'
                    },
                    {
                        element: document.getElementById('importDataBtn'),
                        intro: 'Import previously exported data to restore your information.'
                    },
                    {
                        element: document.getElementById('goalName'),
                        intro: 'Set savings goals to track your financial objectives.'
                    }
                ],
                nextLabel: 'Next',
                prevLabel: 'Back',
                doneLabel: 'Finish'
            }).start();
        }

        // Download PDF report
        function downloadPDF() {
            if (userData.expenses.length === 0) {
                showNotification('No expense data to generate report', 'error');
                return;
            }

            // Show loading overlay
            loadingOverlay.style.display = 'flex';
            
            setTimeout(() => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add header with gradient background
                doc.setFillColor(67, 97, 238);
                doc.rect(0, 0, 210, 40, 'F');
                
                // Title
                doc.setFontSize(24);
                doc.setTextColor(255, 255, 255);
                doc.text('Monthly Financial Report', 105, 20, { align: 'center' });
                
                // Subtitle
                doc.setFontSize(12);
                doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 105, 30, { align: 'center' });
                
                // Summary section
                doc.setFillColor(240, 240, 240);
                doc.rect(10, 45, 190, 40, 'F');
                
                doc.setFontSize(14);
                doc.setTextColor(0, 0, 0);
                doc.text('Financial Summary', 15, 55);
                
                doc.setFontSize(12);
                const total = userData.income;
                const spent = userData.expenses.reduce((total, expense) => total + expense.amount, 0);
                const saving = total - spent;
                const savingPercentage = total > 0 ? (saving / total) * 100 : 0;
                
                doc.text(`Total Income: â‚¹${total.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`, 20, 65);
                doc.text(`Total Spent: â‚¹${spent.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`, 20, 75);
                
                // Savings with color coding
                if (saving >= 0) {
                    doc.setTextColor(46, 204, 113);
                } else {
                    doc.setTextColor(231, 76, 60);
                }
                doc.text(`Savings: â‚¹${saving.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})} (${savingPercentage.toFixed(1)}%)`, 20, 85);
                
                // Reset text color
                doc.setTextColor(0, 0, 0);
                
                // Budget vs Actual table
                doc.setFontSize(14);
                doc.text('Budget vs Actual Spending', 15, 100);
                
                let yPosition = 110;
                
                // Table headers with background
                doc.setFillColor(67, 97, 238);
                doc.setTextColor(255, 255, 255);
                doc.rect(10, yPosition, 190, 10, 'F');
                doc.text('Category', 15, yPosition + 7);
                doc.text('Budget', 70, yPosition + 7);
                doc.text('Actual', 120, yPosition + 7);
                doc.text('Status', 170, yPosition + 7);
                
                yPosition += 10;
                
                // Table rows
                userData.categories.forEach(category => {
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = 20;
                        
                        // Add header to new page
                        doc.setFillColor(67, 97, 238);
                        doc.rect(0, 0, 210, 40, 'F');
                        doc.setFontSize(24);
                        doc.setTextColor(255, 255, 255);
                        doc.text('Monthly Financial Report (Cont.)', 105, 20, { align: 'center' });
                        
                        yPosition = 50;
                        
                        // Table headers again
                        doc.setFillColor(67, 97, 238);
                        doc.rect(10, yPosition, 190, 10, 'F');
                        doc.text('Category', 15, yPosition + 7);
                        doc.text('Budget', 70, yPosition + 7);
                        doc.text('Actual', 120, yPosition + 7);
                        doc.text('Status', 170, yPosition + 7);
                        
                        yPosition += 10;
                    }
                    
                    const recommendedAmount = userData.income * (category.percentage / 100);
                    const actualAmount = userData.expenses
                        .filter(expense => expense.category === category.name)
                        .reduce((total, expense) => total + expense.amount, 0);
                    
                    const difference = actualAmount - recommendedAmount;
                    const differencePercent = recommendedAmount > 0 ? (difference / recommendedAmount) * 100 : 0;
                    
                    doc.setFillColor(240, 240, 240);
                    doc.rect(10, yPosition, 190, 10, 'F');
                    
                    doc.setTextColor(0, 0, 0);
                    doc.text(category.name, 15, yPosition + 7);
                    doc.text(`â‚¹${recommendedAmount.toFixed(2)}`, 70, yPosition + 7);
                    doc.text(`â‚¹${actualAmount.toFixed(2)}`, 120, yPosition + 7);
                    
                    // Status with color coding
                    if (Math.abs(difference) < 1) {
                        doc.setTextColor(46, 204, 113);
                        doc.text('On Track', 170, yPosition + 7);
                    } else if (difference > 0) {
                        doc.setTextColor(231, 76, 60);
                        doc.text(`+â‚¹${difference.toFixed(2)}`, 170, yPosition + 7);
                    } else {
                        doc.setTextColor(46, 204, 113);
                        doc.text(`â‚¹${difference.toFixed(2)}`, 170, yPosition + 7);
                    }
                    
                    yPosition += 10;
                });
                
                // Add footer
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(10);
                    doc.setTextColor(100, 100, 100);
                    doc.text(`Page ${i} of ${pageCount}`, 105, 287, { align: 'center' });
                    doc.text('Generated by Smart Income & Budgeting Tracker', 105, 292, { align: 'center' });
                }
                
                // Save the PDF
                doc.save(`financial-report-${new Date().toISOString().slice(0, 10)}.pdf`);
                
                // Hide loading overlay
                loadingOverlay.style.display = 'none';
                
                showNotification('PDF report downloaded successfully', 'success');
            }, 500);
        }

        // Initialize the app when the DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>